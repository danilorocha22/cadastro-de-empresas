<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="WEB-INF/template/layout.xhtml">

    <ui:define name="titulo">Cadastro de Empresas</ui:define>

    <ui:define name="conteudo">
        <f:metadata><!--permite definir metadados na view-->
            <f:viewAction action="#{empresaBean.listarEmpresas}"/><!--permite chamar o metodo com os dados do banco-->
            <f:viewAction action="#{empresaBean.listarRamoAtividades}"/>
        </f:metadata>

        <h:form>

            <!--Alert-->
            <p:messages>
                <p:autoUpdate/>
            </p:messages>

            <!--Barra de menu-->
            <p:toolbar>
                <f:facet name="left">
                    <p:inputText placeholder="Informe um termo..." value="#{empresaBean.termoPesquisa}"/>

                    <p:commandButton value="Pesquisar" icon="fa fa-search" actionListener="#{empresaBean.pesquisar}"
                                     update="empresaTable"/>

                    <span class="ui-separator">
                        <span class="ui-icon ui-icon-grip-dotted-vertical"/>
                    </span>

                    <p:commandButton value="Novo" icon="fa fa-plus" onclick="PF('novaEmpresaDialog').show()"/>

                    <span class="ui-separator">
                        <span class="ui-icon ui-icon-grip-dotted-vertical"/>
                    </span>

                    <p:commandButton title="Editar" icon="fa fa-edit"/>

                    <p:commandButton title="Excluir" icon="fa fa-trash"/>

                    <span class="ui-separator">
                        <span class="ui-icon ui-icon-grip-dotted-vertical"/>
                    </span>

                    <p:commandButton title="Exportar para o Excel" icon="fa fa-file-excel-o"/>
                </f:facet>
            </p:toolbar>

            <p:spacer height="10px"/>

            <!--Tabela-->
            <p:dataTable id="empresaTable" value="#{empresaBean.empresas}" var="empresa"
                         emptyMessage="Nenhuma informação a ser exibida."
                         paginator="true" rows="10" paginatorPosition="bottom">

                <p:column headerText="Razão Social" sortBy="#{empresa.razaoSocial}">
                    <h:outputText value="#{empresa.razaoSocial}"/>
                </p:column>

                <p:column headerText="Nome Fantasia">
                    <h:outputText value="#{empresa.nomeFantasia}"/>
                </p:column>

                <p:column headerText="CNPJ">
                    <h:outputText value="#{empresa.cnpj}"/>
                </p:column>

                <p:column headerText="Tipo de Empresa">
                    <h:outputText value="#{empresa.tipo}"/>
                </p:column>

                <p:column headerText="Ramo Atividade">
                    <h:outputText value="#{empresa.ramoAtividade.descricao}"/>
                </p:column>
            </p:dataTable>

            <!--Dialog-->
            <p:dialog header="Nova empresa" widgetVar="novaEmpresaDialog" modal="true" resizable="false"
                      closeOnEscape="true">

                <p:panelGrid columns="2">
                    <p:outputLabel value="Razão Social:" for="razaoSocial"/>
                    <p:inputText id="razaoSocial" size="80" maxlength="120"/>

                    <p:outputLabel value="Nome Fantasia:" for="nomeFantasia"/>
                    <p:inputText id="nomeFantasia" size="80" maxlength="80"/>

                    <p:outputLabel value="Tipo de Empresa:" for="tipo"/>
                    <p:selectOneMenu id="tipo">
                        <f:selectItem itemLabel="Selecione..."/>
                        <f:selectItems value="#{empresaBean.tiposEmpresa}" var="tipoEmpresa"
                                       itemLabel="#{tipoEmpresa.descricao}" itemValue="#{tipoEmpresa}"/>
                    </p:selectOneMenu>

                    <p:outputLabel value="CNPJ:" for="cnpj"/>
                    <p:inputMask id="cnpj" mask="99.999.999/9999-99" size="18" maxlength="18"/>

                    <p:outputLabel value="Data Fundação:" for="dataFundacao"/>
                    <p:calendar id="dataFundacao" pattern="dd/MM/yyyy" size="80" maxlength="80"/>

                    <p:outputLabel value="Ramo Atividade" for="ramo"/>
                    <p:autoComplete id="ramo" size="80" maxlength="80"
                                    completeMethod="#{empresaBean.completarRamoAtividade}"
                                    converter="#{empresaBean.ramoAtividadeConverter}"
                                    var="ramoAtividade" itemLabel="#{ramoAtividade.descricao}"
                                    itemValue="#{ramoAtividade}"/>

                    <h:outputLabel/>
                    <p:commandButton value="Salvar"/>

                </p:panelGrid>

            </p:dialog>
        </h:form>
    </ui:define>
</ui:composition>